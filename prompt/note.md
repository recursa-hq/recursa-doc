# Noca-Task is doc focused workflow for anti-context-rot LLM Agents parallel-collaboration in the most efficient token context windows. this way;

1. sub-agents never loose context by living and breathing in a strict structure.
2. manager agent can delegate easily by mentioning paths, files and ids.
3. all coms so concise using hacker news netizen language style.
4. tmux based spawning
5. git worktree when the plan parts says isolation: true
6. 6 digits ids

# Strict Structure and naming conventions

noca-task/
├── initialization/         # Phase: Boilerplate blueprint with content of only todo list comments and imports statement.
│   ├── agent-log/          # plan execution logs generated by init.agent-swarms.md
│   │   ├── 463462.log.md
│   │   └── 823523.log.md
│   ├── plan/                               # kanban yml position managed by individual init.agent-swarms.md
│   │   ├── todo/                           # yml files in todo generated by noca.agent.md using plan.prompt.md
│   │   │   ├── 463462.todo.plan.yml
│   │   │   └── 674345.todo.plan.yml
│   │   ├── doing/
│   │   │   └── 734567.doing.plan.yml
│   │   ├── review/               # files will be processed by manager.agent.md that can also spawn init.agent-swarms.md
│   │   │   ├── 463462.todo.plan.yml
│   │   │   └── 356446.review.plan.yml
│   │   ├── in-review/            # claimed lock by manager.agents.md that can also spawn another init.agent-swarms.md
│   │   │   ├── 646344.todo.plan.yml
│   │   ├── done/
│   │   │   └── 553464.done.plan.yml
│   │   └── failed/
│   │       └── 745463.failed.plan.yml
│   ├── init.agent-swarms.md                # Execute yml plan/ files while also self-manage plan/ files and agent-log
│   └── init.phase.rule.md                  # should be no isolation in this phase
├── development/            # Phase: when all yml plan/ in initialization/ are done/. then this active development for production-ready codebase, green test and zero linting problems
│   ├── agent-log/          # plan execution logs generated by dev.agent-swarms.md
│   │   ├── 4534667.log.md
│   │   └── 3646544.log.md
│   ├── plan/                               # kanban yml position managed by individual dev.agent-swarms.md
│   │   ├── todo/                           # yml files in todo generated by noca.agent.md using plan.prompt.md
│   │   │   ├── 3646544.todo.plan.yml
│   │   │   └── 4534667.todo.plan.yml
│   │   ├── doing/
│   │   │   └── 2145365.doing.plan.yml
│   │   ├── review/               # files will be processed by manager.agents.md that can also spawn dev.agent-swarms.md
│   │   │   ├── 8797645.todo.plan.yml
│   │   │   └── 2345357.review.plan.yml
│   │   ├── in-review/            # claimed lock by manager.agents.md that can also spawn another init.agent-swarms.md
│   │   │   ├── 4634623.todo.plan.yml
│   │   ├── done/
│   │   │   └── 4574743.done.plan.yml
│   │   └── failed/
│   │       └── 4567454.failed.plan.yml
│   ├── dev.agent-swarms.md                # Execute yml plan/ files while also self-manage plan/ files and agent-log
│   └── dev.phase.rule.md                  # should be no isolation in this phase
├── plan.agents.md                          # Focus on generating plan/ yml todo files based on user input using plan.prompt.md
├── plan.prompt.md
├── manager.agents.md                       #
├── manager.prompt.md
└──

file examples ===

plan.prompt.md

```markdown

you are master architect for complex refactor code. use hacker news language style. your plan will be used by another intelligence for generating code patches. after you create the plan , reshape the plan in below yaml format ;

#  context_files: identify which files that has relevant context to be included to another llm for the given scope(plan/parts) intention. to prevent hallucination from llm. also include upcoming newly created files

 compact: # affected files on the scope of parts steps, or plan
 medium: # affected files + additional context
 extended: # affected files + additional context + more extended

  ```yaml
  plan:
    uuid: 'generate-random-regular-uuid'
    status: 'todo'  # Must be one of: todo, doing, done, cancel
    title: 'A short, descriptive title for the master plan'
    introduction: |
      A multi-line introduction paragraph explaining the overall goal and high-level approach. Keep it 2-4 paragraphs.
    parts:
      - uuid: 'generate-random-regular-uuid'
        status: 'todo'
        name: 'Part 1: Descriptive Name'
        reason: |
          A multi-line reason why this part is needed.
        steps:
          - uuid: 'generate-random-regular-uuid'
            status: 'todo'
            name: 'Step Name (e.g., 1. Action Description)'
            reason: |
              A multi-line reason for this step.
            files:
              - file1.ext
              - file2.ext
            operations:
              - 'Bullet-point style operation 1: Describe the change clearly.'
              - 'Bullet-point style operation 2: Use single quotes for code snippets like `functionName()`.'
          - uuid: 'generate-random-regular-uuid'
            status: 'todo'
            name: 'Another Step Name'
            reason: |
              Reason here.
            files: []
            operations:
              - 'Operation description.'
        context_files:
          compact:
            - file1.ext
          medium:
            - file1.ext
            - file2.ext
          extended:
            - file1.ext
            - file2.ext
            - file3.ext
      - uuid: 'generate-random-regular-uuid'
        status: 'todo'
        name: 'Part 2: Another Descriptive Name'
        reason: |
          Reason for the part.
        steps:
          # Similar structure as above, with uuid and status for each step
        context_files:
          compact:
            - file1.ext
          medium:
            - file1.ext
          extended:
            - file1.ext
            - file2.ext
    conclusion: |
      A multi-line conclusion summarizing benefits and impact.
    context_files:
      compact: # affected files
        - file1.ext
      medium: # affected files + additional context
        - file1.ext
        - file2.ext
      extended: # affected files + additional context + more extended context
        - file1.ext
        - file2.ext
        - file3.ext
  ```

```


463462.todo.plan.yml

```yaml
plan:
  uuid: 'c8a2b1f0-4d5e-4b9c-8a7f-6e5d4c3b2a1f'
  status: 'todo'
  title: 'Refactor Filesystem Ops to Align with Docs & Git Specs'
  introduction: |
    This plan addresses critical discrepancies between our implementation, our documentation, and standard tool behavior (specifically `git`). The current `.gitignore` handling is naive, only processing the root-level file, which is incorrect and leads to improper file traversal in any non-trivial repository. This is a significant deviation from documented specs and user expectations.

    Our primary objective is to implement a robust, recursive `.gitignore` parsing mechanism that correctly reflects `git`'s behavior, including precedence rules for nested ignore files. This will make our `mem` API's file-based tools (`queryGraph`, `searchGlobal`, etc.) reliable and predictable.

    Additionally, we will correct inaccuracies in our API documentation (`tools.md`) to ensure it is a trustworthy resource. We'll also improve code clarity by renaming ambiguous functions in our filesystem walker. This effort will harden the codebase, eliminate a class of potential bugs, and improve overall developer experience.
  parts:
    - uuid: '9e7f8a7b-6c5d-4a3b-2c1d-0e9f8a7b6c5d'
      status: 'todo'
      name: 'Part 1: Implement True Recursive .gitignore Handling'
      reason: |
        The current implementation in `gitignore-parser.ts` only reads the `.gitignore` file from the knowledge graph's root. This is fundamentally incorrect, as `git` respects `.gitignore` files in any subdirectory, with specific precedence rules. This flaw means our agent will incorrectly process files that should be ignored, leading to unpredictable behavior and potential context pollution. This overhaul is critical for robust and correct file system interaction.
      steps:
        - uuid: 'a1b2c3d4-e5f6-4a3b-8c7d-6e5f4a9b8c7d'
          status: 'todo'
          name: '1. Introduce `createProjectIgnoreFilter` in gitignore-parser.ts'
          reason: |
            We need a new top-level function that can build a comprehensive ignore filter for the entire project, not just a single directory. This function will be the core of the new, correct implementation.
          files:
            - 'src/lib/gitignore-parser.ts'
            - 'src/core/mem-api/fs-walker.ts'
          operations:
            - 'In `src/lib/gitignore-parser.ts`, create a new async helper function `simpleWalk` that recursively yields all file paths in a directory. This walker must not use any ignore logic, as its purpose is to find the `.gitignore` files themselves.'
            - 'Create and export a new async function `createProjectIgnoreFilter(rootDir: string): Promise<(filePath: string) => boolean>`. This will replace the old `createIgnoreFilter`.'
            - 'Inside `createProjectIgnoreFilter`, use `simpleWalk` to find all `.gitignore` files within `rootDir`.'
            - 'Read and parse each found `.gitignore` file. Store the patterns in a single list, ensuring each pattern is associated with its base directory (the directory containing its `.gitignore` file).'
        - uuid: 'b2c3d4e5-f6a5-4b3c-9d8e-7f6a5b4c3b2a'
          status: 'todo'
          name: '2. Implement Correct Precedence and Filtering Logic'
          reason: |
            Git's ignore logic depends on the location of the `.gitignore` file and the order of patterns within it. The last matching pattern wins. Our new filter must correctly replicate this behavior by processing patterns from all `.gitignore` files in the correct order.
          files:
            - 'src/lib/gitignore-parser.ts'
          operations:
            - 'Inside `createProjectIgnoreFilter`, create a master list of all parsed patterns from all `.gitignore` files.'
            - 'Sort this master list to respect precedence: patterns from parent directories should be processed before patterns from child directories. Within a single file, the order must be preserved.'
            - 'The returned filter function `(filePath: string) => boolean` must iterate through the sorted patterns. For each pattern, it should calculate the `relativePath` from the pattern''s base directory and use the existing `matchesPattern` helper.'
            - 'The function must track the `isIgnored` state, allowing the last matching pattern in the entire sorted list to determine the final outcome for the given `filePath`.'
        - uuid: 'c3d4e5f6-a5b4-4c3d-8e7f-6a5b4c3d2a1b'
          status: 'todo'
          name: '3. Update Consumers and Clean Up Old Code'
          reason: |
            With the new robust filter in place, we must switch our file-walking consumers to use it and remove the old, incorrect implementation to prevent future misuse.
          files:
            - 'src/core/mem-api/graph-ops.ts'
            - 'src/lib/gitignore-parser.ts'
          operations:
            - 'In `src/core/mem-api/graph-ops.ts`, find all functions that use `createIgnoreFilter` (e.g., `queryGraph`, `getBacklinks`, `searchGlobal`).'
            - 'Replace the line `const isIgnored = await createIgnoreFilter(graphRoot);` with `const isIgnored = await createProjectIgnoreFilter(graphRoot);`.'
            - 'In `src/lib/gitignore-parser.ts`, delete the now-obsolete `createIgnoreFilter` and `combineIgnoreFilters` functions.'
      context_files:
        compact:
          - 'src/lib/gitignore-parser.ts'
          - 'src/core/mem-api/graph-ops.ts'
        medium:
          - 'src/lib/gitignore-parser.ts'
          - 'src/core/mem-api/graph-ops.ts'
          - 'src/core/mem-api/fs-walker.ts'
        extended:
          - 'src/lib/gitignore-parser.ts'
          - 'src/core/mem-api/graph-ops.ts'
          - 'src/core/mem-api/fs-walker.ts'
          - '.gitignore'
          - 'tests/integration/mem-api.test.ts'
    - uuid: '8d7e6f5a-4b3c-2d1e-0a9b-8c7d6e5f4a3b'
      status: 'todo'
      name: 'Part 2: Align API Documentation with Implementation'
      reason: |
        The documentation in `tools.md` for `mem.gitLog` incorrectly states that `filePath` is a required parameter. The implementation and type definitions correctly treat it as optional, allowing a query of the entire repository's history. This discrepancy can mislead the LLM and developers. The docs must be the source of truth.
      steps:
        - uuid: 'd4e5f6a5-b4c3-3d2e-9f8a-7b6c5d4e3b2a'
          status: 'todo'
          name: '1. Correct mem.gitLog Signature in tools.md'
          reason: |
            To ensure our documentation is accurate and reliable, we must update the signature and description to match the actual code behavior.
          files:
            - 'docs/tools.md'
          operations:
            - 'Open `docs/tools.md`.'
            - 'Locate the row for `mem.gitLog` in the "Git-Native Operations" table.'
            - 'Change the signature from `(filePath: string, maxCommits: number = 5)` to `(filePath?: string, maxCommits?: number = 5)`.'
            - 'Update the description to clarify that if `filePath` is omitted, the function returns the log for the entire repository.'
      context_files:
        compact:
          - 'docs/tools.md'
        medium:
          - 'docs/tools.md'
          - 'src/types/mem.ts'
        extended:
          - 'docs/tools.md'
          - 'src/types/mem.ts'
          - 'src/core/mem-api/git-ops.ts'
    - uuid: '7c6b5a4d-3e2d-1f0a-9b8c-7d6e5f4a3b2a'
      status: 'todo'
      name: 'Part 3: Improve Code Clarity in Filesystem Traversal'
      reason: |
        The function `walk` in `fs-walker.ts` is ambiguously named. It only yields files, not directories, but its name doesn't imply this. This can lead to incorrect assumptions and bugs if a developer tries to use it to traverse a full directory tree. Renaming it to `walkFiles` makes its behavior explicit and the code easier to reason about.
      steps:
        - uuid: 'e5f6a5b4-c3d2-2e1f-8a7b-6c5d4e3b2a1f'
          status: 'todo'
          name: '1. Rename `walk` to `walkFiles`'
          reason: |
            To make the function''s purpose unambiguous and prevent misuse.
          files:
            - 'src/core/mem-api/fs-walker.ts'
            - 'src/core/mem-api/graph-ops.ts'
          operations:
            - 'In `src/core/mem-api/fs-walker.ts`, rename the async generator `walk` to `walkFiles`.'
            - 'In `src/core/mem-api/graph-ops.ts`, update all imports and calls from `walk` to `walkFiles`.'
      context_files:
        compact:
          - 'src/core/mem-api/fs-walker.ts'
          - 'src/core/mem-api/graph-ops.ts'
        medium:
          - 'src/core/mem-api/fs-walker.ts'
          - 'src/core/mem-api/graph-ops.ts'
        extended:
          - 'src/core/mem-api/fs-walker.ts'
          - 'src/core/mem-api/graph-ops.ts'
  conclusion: |
    By executing this plan, we will elevate the codebase from a functional prototype to a robust, reliable tool. The corrected `.gitignore` logic is the centerpiece, ensuring our agent interacts with the filesystem exactly as a developer would expect, preventing a whole class of context and file-handling errors.

    Aligning the documentation and improving code clarity are not minor tweaks; they are investments in maintainability and future development speed. A developer or an LLM looking at our codebase will find it predictable, honest, and easier to build upon. This is a crucial step in hardening the core foundation of the Recursa agent.
  context_files:
    compact:
      - 'src/lib/gitignore-parser.ts'
      - 'src/core/mem-api/graph-ops.ts'
      - 'src/core/mem-api/fs-walker.ts'
      - 'docs/tools.md'
    medium:
      - 'src/lib/gitignore-parser.ts'
      - 'src/core/mem-api/graph-ops.ts'
      - 'src/core/mem-api/fs-walker.ts'
      - 'docs/tools.md'
      - 'src/types/mem.ts'
      - 'src/core/mem-api/git-ops.ts'
    extended:
      - 'src/lib/gitignore-parser.ts'
      - 'src/core/mem-api/graph-ops.ts'
      - 'src/core/mem-api/fs-walker.ts'
      - 'docs/tools.md'
      - 'src/types/mem.ts'
      - 'src/core/mem-api/git-ops.ts'
      - 'tests/integration/mem-api.test.ts'
      - '.gitignore'
```
